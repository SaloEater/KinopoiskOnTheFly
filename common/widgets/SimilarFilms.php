<?php


namespace common\widgets;


use common\services\similar\IBuilder;
use yii\base\Widget;
use yii\helpers\Html;

class SimilarFilms extends Widget
{
    public $searchers;

    public $maximum = null;

    public $searcherObjects;

    public function init()
    {
        parent::init(); // TODO: Change the autogenerated stub
        if (!$this->maximum) {
            $this->maximum = 5;
        }

        foreach ($this->searchers as $searcher) {
            $this->searcherObjects = \Yii::createObject($searcher['class'], $searcher['config']);
        }
    }

    public function run()
    {
        $filmIDs = [];
        foreach ($this->searcherObjects as $searcher) {
            array_merge($filmIDs, $searcher->search());
            $filmIDs = array_unique($filmIDs);
            if (count($filmIDs) > $this->maximum) {
                break;
            }
        }

        $content = '';
        foreach ($filmIDs as $filmID)
        {
            $content .= Html::tag('div', SmallFilmViewWidget::widget([
                    'filmId' => $filmID
                ]), [
                    'class' => 'd-inline-block'
                ]) . ' ';
        }

        return Html::tag('div', $content, [
            'class' => 'border border-dark'
        ]);
    }
}